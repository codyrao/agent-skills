# Web API 开发规范

## 命名规范

### URL 命名
- 使用小写字母
- 单词间用连字符（-）分隔
- URL 应清晰表达资源
- 使用名词复数形式
- 避免使用动词
- 避免使用文件扩展名
- 避免使用特殊字符

### 路径变量命名
- 使用驼峰命名法（camelCase）
- 首字母小写
- 变量名应具有描述性

### 查询参数命名
- 使用驼峰命名法（camelCase）
- 首字母小写
- 参数名应具有描述性
- 布尔参数以 `is`、`has`、`can` 等前缀开头

### 请求体字段命名
- 使用驼峰命名法（camelCase）
- 首字母小写
- 字段名应具有描述性
- 布尔字段以 `is`、`has`、`can` 等前缀开头

### 响应体字段命名
- 使用驼峰命名法（camelCase）
- 首字母小写
- 字段名应具有描述性
- 布尔字段以 `is`、`has`、`can` 等前缀开头

## HTTP 方法规范

### GET 方法
- 用于获取资源
- 请求参数通过 URL 查询参数传递
- 不应修改服务器状态
- 请求体不应包含数据
- 响应可被缓存

### POST 方法
- 用于创建资源
- 请求参数通过请求体传递
- 请求体使用 JSON 格式
- 如果需要传入参数很复杂的读请求，可以用 Post 进行读请求
- 响应状态码 201 表示创建成功

### PUT 方法
- 用于更新整个资源
- 请求参数通过请求体传递
- 请求体使用 JSON 格式
- 响应状态码 200 或 204 表示更新成功

### PATCH 方法
- 用于部分更新资源
- 请求参数通过请求体传递
- 请求体使用 JSON 格式
- 响应状态码 200 或 204 表示更新成功

### DELETE 方法
- 用于删除资源
- 请求参数通过 URL 查询参数传递
- 响应状态码 200 或 204 表示删除成功

## URL 设计规范

### 资源路径
- 使用名词表示资源
- 使用复数形式
- 路径层级不超过 3 层
- 示例：`/api/users`
- 示例：`/api/users/{userId}/orders`

### 版本控制
- 使用 URL 路径版本控制
- 版本号使用 `v1`、`v2` 格式
- 示例：`/api/v1/users`

### 查询参数
- 使用查询参数过滤、排序、分页
- 过滤参数：`?status=active&type=user`
- 排序参数：`?sort=createdAt&order=desc`
- 分页参数：`?page=1&pageSize=10`
- 字段过滤：`?fields=id,name,email`

### 路径变量
- 使用路径变量标识资源
- 路径变量使用驼峰命名法
- 示例：`/api/users/{userId}`

## 请求规范

### 请求头
- 设置 `Content-Type: application/json`
- 设置 `Accept: application/json`
- 设置 `User-Agent` 标识客户端
- 设置 `Authorization` 进行认证
- 设置 `X-Request-ID` 追踪请求

### 请求体
- 使用 JSON 格式
- 使用 UTF-8 编码
- 字段使用驼峰命名法
- 日期时间使用 ISO 8601 格式
- 布尔值使用 true/false
- 数字不使用引号
- 空值使用 null

### 请求参数验证
- 验证必填字段
- 验证字段类型
- 验证字段长度
- 验证字段格式（邮箱、手机号等）
- 验证字段取值范围
- 验证业务规则

### 请求参数示例
```json
{
  "userName": "john.doe",
  "email": "john.doe@example.com",
  "age": 30,
  "isActive": true,
  "createdAt": "2024-01-01T00:00:00Z"
}
```

## 响应规范

### 响应状态码
- 200 OK：请求成功
- 201 Created：资源创建成功
- 204 No Content：请求成功，无返回内容
- 400 Bad Request：请求参数错误
- 401 Unauthorized：未认证
- 403 Forbidden：无权限
- 404 Not Found：资源不存在
- 409 Conflict：资源冲突
- 422 Unprocessable Entity：请求参数验证失败
- 500 Internal Server Error：服务器内部错误
- 503 Service Unavailable：服务不可用

### 响应体结构
- 统一使用以下结构：
```json
{
  "code": 200,
  "message": "success",
  "data": {},
  "timestamp": "2024-01-01T00:00:00Z",
  "requestId": "abc123"
}
```

### 成功响应
- `code`：200
- `message`：成功描述
- `data`：返回数据

### 错误响应
- `code`：错误码
- `message`：错误描述
- `data`：错误详情（可选）

### 分页响应
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "items": [],
    "total": 100,
    "page": 1,
    "pageSize": 10
  },
  "timestamp": "2024-01-01T00:00:00Z",
  "requestId": "abc123"
}
```

### 响应体字段命名
- 使用驼峰命名法（camelCase）
- 首字母小写
- 字段名应具有描述性
- 布尔字段以 `is`、`has`、`can` 等前缀开头

## 认证和授权

### 认证方式
- 使用 JWT（JSON Web Token）认证
- Token 放在请求头 `Authorization: Bearer {token}`
- Token 有效期不超过 24 小时
- 使用 Refresh Token 刷新访问令牌

### 权限控制
- 使用 RBAC（基于角色的访问控制）
- 接口级别权限控制
- 数据级别权限控制
- 资源级别权限控制

### API Key
- 使用 API Key 进行服务间调用
- API Key 放在请求头 `X-API-Key: {apiKey}`
- API Key 定期轮换

## 安全规范

### HTTPS
- 所有 API 必须使用 HTTPS
- 禁止使用 HTTP
- 配置合理的 SSL/TLS 版本

### 输入验证
- 验证所有输入参数
- 防止 SQL 注入
- 防止 XSS 攻击
- 防止 CSRF 攻击

### 输出编码
- 对输出数据进行编码
- 不暴露敏感信息
- 不返回系统错误详情

### 限流
- 实现 API 限流
- 限制单个用户的请求频率
- 限制单个 IP 的请求频率
- 使用令牌桶或漏桶算法

### 防重放
- 使用时间戳和随机数防重放
- 请求有效期不超过 5 分钟
- 记录已处理的请求 ID

## 性能优化

### 缓存
- 使用 HTTP 缓存头
- 使用 CDN 缓存静态资源
- 使用 Redis 缓存热点数据
- 设置合理的缓存过期时间

### 压缩
- 使用 Gzip 压缩响应体
- 压缩响应体大于 1KB 的数据

### 连接池
- 使用 HTTP 连接池
- 配置合理的连接池大小
- 设置合理的连接超时时间

### 异步处理
- 耗时操作使用异步处理
- 使用消息队列处理异步任务
- 提供任务查询接口

### 分页
- 大数据量查询使用分页
- 限制单页返回数量
- 默认每页返回 10 条数据
- 最大每页返回 100 条数据

## 文档规范

### API 文档
- 使用 OpenAPI (Swagger) 规范
- 提供完整的 API 文档
- 提供请求和响应示例
- 提供错误码说明

### 版本说明
- 记录 API 版本变更
- 说明废弃的 API
- 提供迁移指南

### 测试接口
- 提供测试环境
- 提供测试数据
- 提供测试账号

## 监控和日志

### 日志记录
- 记录所有请求
- 记录响应状态码
- 记录响应时间
- 记录错误信息
- 不记录敏感信息

### 监控指标
- 监控请求量
- 监控响应时间
- 监控错误率
- 监控并发数
- 监控资源使用

### 告警
- 设置合理的告警阈值
- 错误率超过 1% 告警
- 响应时间超过 1s 告警
- 服务不可用立即告警

## 最佳实践

### 幂等性
- GET、PUT、DELETE 方法应具有幂等性
- 使用唯一 ID 保证幂等性
- 记录已处理的请求

### 事务
- 跨服务操作使用分布式事务
- 使用 Saga 模式处理长事务
- 提供事务查询接口

### 重试
- 实现客户端重试机制
- 重试次数不超过 3 次
- 重试间隔指数退避
- 幂等接口支持重试

### 降级
- 实现服务降级
- 降级策略清晰
- 提供降级通知

### 熔断
- 实现熔断机制
- 熔断阈值合理
- 熔断后自动恢复

## 禁止事项

- 禁止使用 HTTP
- 禁止在 URL 中传递敏感信息
- 禁止在响应中暴露系统错误详情
- 禁止在响应中返回密码等敏感信息
- 禁止使用 GET 方法修改数据
- 禁止使用 POST 方法获取数据（参数复杂的读请求除外）
- 禁止在请求体中传递查询参数
- 禁止在响应中返回过多数据
- 禁止在响应中返回未请求的字段
- 禁止在响应中返回嵌套层级过深的数据
